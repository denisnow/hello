<!doctype html>

<html lang="en">

	<head>
	
		<meta charset="utf-8">
		<link href="https://fonts.googleapis.com/css?family=Roboto+Mono&display=swap" rel="stylesheet">

		<style>
			.reactMainComponent {
				font-family: "Roboto Mono", monospace;
				font-size: 15vw;
			}
		</style>

	</head>

	<body>

		<div class="reactMainComponent"></div>

		<script type="text/babel">
		
		// ------------------------ App module ------------------------------------

		function App() {

			return <div><TextSmart textToDisplay="hello" /><CursorSmart /></div>;

		}

		// ------------------------ Text smart module -----------------------------

		class TextSmart extends React.Component {

			constructor() {
				super();
				this.state = { displayedText: "" };	
			}

			displayFirstChar() {
				setTimeout(() => this.setState( { displayedText: this.props.textToDisplay[0] } ), 555);
			}

			displayNextChar() {
				let isFullTextDisplayed = this.state.displayedText.length === this.props.textToDisplay.length;

				if (!isFullTextDisplayed) {
					let charToDisplay = this.props.textToDisplay[this.state.displayedText.length];		
					let previousChar = this.props.textToDisplay[this.state.displayedText.length-1];
					
					let delayLength = (charToDisplay === previousChar) ? 150 : 333 + Math.random() * 777;

					let addCharToDisplayedText = function() {
						this.setState( { displayedText: this.state.displayedText + charToDisplay } );
					}.bind(this);
					
					setTimeout(addCharToDisplayedText, delayLength);
				}
			}

			componentDidMount() {
				this.displayFirstChar();
			}
			
			componentDidUpdate() {
				this.displayNextChar();
			}

			render() {
				return <span>{this.state.displayedText}</span>;
			}
		}

		// ------------------------ Cursor smart module ---------------------------

		class CursorSmart extends React.Component {

			constructor() {
				super();
				this.state = { cursor: "_" };
			}

			toggleCursorState() {
				let newState = (this.state.cursor) ? { cursor: "" } : { cursor: "_" };
					
				setTimeout(() => this.setState(newState), 555);
			}

			componentDidMount() {
				this.toggleCursorState();
			}
			
			componentDidUpdate() {
				this.toggleCursorState();
			}

			render() {
				return <span>{this.state.cursor}</span>;
			}
		}

		// -----------------------------------------------------------------------

		ReactDOM.render(<App />, document.body.querySelector(".reactMainComponent"));

		</script>

		<script src="https://unpkg.com/babel-standalone@6.26.0/babel.min.js"></script>
		<script src="https://unpkg.com/react@16.7.0/umd/react.production.min.js" crossorigin></script>
		<script src="https://unpkg.com/react-dom@16.7.0/umd/react-dom.production.min.js" crossorigin></script>

	</body>

</html>